#! /bin/sh

set -eu

layouts_file="$XDG_CONFIG_HOME/X11/xkb_layouts"

if [ ! -s "$layouts_file" ]; then
    exit
fi

current_layout=$(setxkbmap -query | grep layout | awk "{ print \$NF }")
line=$(grep -n "$current_layout" "$layouts_file" | cut -d ":" -f 1)

if [ "$line" = "$(cat "$layouts_file" | wc -l)" ]; then
    line=1
else
    line=$((line + 1))
fi

setxkbmap $(sed "${line}q;d" "$layouts_file")
